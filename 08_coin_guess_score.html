<!DOCTYPE html>
<html>

<head>
    <title> Ch08 Objects: Coin Guess </title>
    <style>
        /*css*/
    </style>
</head>

<body>
    <!--html -->
    <p> <strong>Game Logic</strong>: <br>
        as we click a button <br>
        1: Computer randomly selects a move.<br>
        1-1: use random number to generate a float between 0~1.<br>
        1-2: use 1/2 to distinguish 2 cases. if in corresponding interval then comouter chooses h/t.<br>
        2: Compare the moves(user chosen one) to get the results.<br>
        3: Display the result in a popup. <br>
    </p>
    <hr>
    <h3> Flip coins </h3>

    <button data-action='move' data-user_move="head"> Head </button>
    <button data-action='move' data-user_move="tail"> Tail </button>
    <button data-action='reset' id="reset-btn"> Reset Score</button>
    <!-- we need to add a button and then using it to update the score-->
    <div id="scoreboard">Wins: 0 | Losses: 0 </div>


    <script>
        // js code
        // functions we need:
        // 1, random generated computer move
        // 2, compare user and computer move, give results
        // !!! 3-2, update and display the result and score in a popup.
        // 3, create a pop up saying tie, win or lose.
        // use data- to define, and decouple the actual button context with the data name.
        // always put global variables first, then logic(functions), then call them and connect them to the elements on html-page.

        // storage layer:
        function saveToLocal(key, obj) {
            localStorage.setItem(key, JSON.stringify(obj));
        }

        function loadFromLocal(key, defaultValue = {}) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : defaultValue;
        }

        function removeFromLocal(key) {
            localStorage.removeItem(key);
        }

        // variables:
        let computer_move = '';
        const score = loadFromLocal('score', { wins: 0, ties: 0 });

        // use local storage!!!


        // functions: 
        function getComputerMove() {
            const random_number = Math.random();
            // Rock case, 0 ~ 1/3
            // Paper case, 1/3 ~ 2/3
            // Scissors case, 2/3 ~ 1
            let computer_move = '';
            if (random_number >= 0 && random_number < (1 / 2)) {
                computer_move = 'head';
                // console.log('computer move is head');
            } else if (random_number >= 1 / 2 && random_number <= (1)) {
                computer_move = 'tail';
                // console.log('computer move is tail');
            }
            return computer_move;
        }

        function compareMoves(user_move, computer_move) {
            let result = '???';

            if (user_move === computer_move) {
                result = `you both picked ${user_move}, you win.`
                return result;
            } else {
                result = `you picked ${user_move}, computer picked ${computer_move}, You lose.`
            }

            return result;
        }

        function updateScores(result) {
            if (result.includes('win')) {
                score.wins++;
            } else if (result.includes('lose')) {
                score.losses++;
            } 
            saveToLocal('score', score);
        }

        function resetScores() {
            score.wins = 0;
            score.losses = 0;
            alert("Score has been reset to 0!");
            // delete localstorage after reset to 0
            removeFromLocal('score'); // we can also put it in game logic, not inside of reset functions
            return; // nolonger go through the game logic
        }

        function renderScore() {
            document.getElementById('scoreboard').textContent =
                `Wins: ${score.wins} | Losses: ${score.losses}`;
        }

        // binding logic
        // 2nd using event delegation ===================
        document.body.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            // only for buttons.
            if (!button) {
                return;
            }

            const action = button.dataset.action;

            if (action === 'reset') {
                resetScores();
                renderScore();
            }

            if (action === 'move') {
                // get user move
                const user_move = button.dataset.user_move;
                // get computer move
                computer_move = getComputerMove();
                // get results
                let result = compareMoves(user_move, computer_move);
                updateScores(result);
                // console.log(result);
                console.log(score);

                // show result in popup
                alert(`${result}
                Wins: ${score.wins} 
                Losses: ${score.losses}`);

                // keep a scoreboard:
                renderScore();
            }
        }); // 2nd

        //initialization: 
        renderScore(); 
    </script>
</body>

</html>